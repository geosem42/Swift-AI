import{d as h,r as u,o as i,b as p,w as f,f as e,i as o,j as n,n as m,t as l,p as g,F as y,l as _}from"./app-9e33c640.js";import{A as b}from"./AppLayout-2b6f5ed3.js";import{h as v,f as d,m as T,n as k,o as F}from"./apiService-34b53e87.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";const w=h({components:{AppLayout:b},data(){return{file:null,transcriptions:[],errors:{},isTranscribing:!1,state:{isLoading:!0},currentPage:1,lastPage:null,isFetchingMore:!1}},async mounted(){try{console.log("Before fetching transcriptions, isLoading:",this.state.isLoading),this.state.isLoading=!0,console.log("Fetching transcriptions, isLoading:",this.state.isLoading),this.fetchTranscriptions(this.currentPage)}catch(s){v(s),this.errors=s.errors||{message:"An unexpected error occurred while fetching transcriptions."}}finally{}},methods:{handleFileUpload(){const s=this.$refs.fileInput;this.file=s.files[0]},loadMore(){this.fetchTranscriptions(this.currentPage+1)},async transcribeAudio(){this.isTranscribing=!0;try{const s=await d(),t=await T(this.file,s);this.transcriptions.unshift({file:this.file.name,unique_name:t.unique_name,text:t.text})}catch(s){s.source==="frontend"?this.errors=s.errors:this.errors=k(s||{message:["An unexpected error occurred."]})}finally{this.isTranscribing=!1,this.file=null,this.$refs.fileInput.value=null}},async fetchTranscriptions(s){s===1?this.state.isLoading=!0:this.isFetchingMore=!0;try{const t=await d(),a=await F(t,s);a&&a.data&&(this.transcriptions=[...this.transcriptions,...a.data],this.currentPage=a.current_page,this.lastPage=a.last_page)}catch(t){console.error("Error fetching transcriptions:",t)}finally{s===1?this.state.isLoading=!1:this.isFetchingMore=!1}},clearError(s){this.errors[s]&&(this.errors[s]="")}}}),M={class:"h-100 position-relative"},A={key:0,class:"d-flex justify-content-center align-items-center h-100"},C=e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),P=[C],$={key:1,class:"container-fluid px-4"},E=e("h1",{class:"mt-4"},"Speech To Text",-1),B={class:"mb-3"},I={id:"upload-form",class:"bg-primary p-4 text-white rounded"},U=e("label",{for:"formFile",class:"form-label"},"Upload Audio File",-1),S={key:0,class:"invalid-feedback"},j=["disabled"],q={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},z={key:1},N={key:0},V={class:"card-header"},Y={class:"card-body"},D={class:"card-title"},G=["src"],H={class:"card-text"},J={key:1,class:"alert alert-light mt-3"},K={id:"loadmore",class:"text-center"},O={key:1,class:"d-flex justify-content-center mt-4"},Q=e("div",{class:"spinner-border text-primary",style:{width:"2rem",height:"2rem"},role:"status"},[e("span",{class:"visually-hidden"},"Loading more...")],-1),R=[Q];function W(s,t,a,X,Z,x){const c=u("app-layout");return i(),p(c,{title:"Speech To Text"},{default:f(()=>[e("main",M,[s.state.isLoading?(i(),o("div",A,P)):n("",!0),s.state.isLoading?n("",!0):(i(),o("div",$,[E,e("div",B,[e("div",I,[U,e("input",{class:m(["form-control",{"is-invalid":s.errors.file}]),type:"file",id:"formFile",ref:"fileInput",name:"file",accept:".mp3",onChange:t[0]||(t[0]=(...r)=>s.handleFileUpload&&s.handleFileUpload(...r)),onInput:t[1]||(t[1]=r=>s.clearError("file"))},null,34),s.errors.file?(i(),o("div",S,l(s.errors.file[0]),1)):n("",!0),e("button",{type:"button",class:"btn btn-secondary mt-2",onClick:t[2]||(t[2]=g((...r)=>s.transcribeAudio&&s.transcribeAudio(...r),["prevent"])),disabled:s.isTranscribing},[s.isTranscribing?(i(),o("span",q)):n("",!0),s.isTranscribing?n("",!0):(i(),o("span",z,"Upload"))],8,j)]),s.transcriptions.length>0?(i(),o("div",N,[(i(!0),o(y,null,_(s.transcriptions,r=>(i(),o("div",{class:"card bg-light mt-5",key:r.id},[e("h5",V,l(r.file),1),e("div",Y,[e("h5",D,[e("audio",{controls:"",src:"/storage/transcriptions/"+r.unique_name}," Your browser does not support the audio element. ",8,G)]),e("p",H,l(r.text),1)])]))),128))])):(i(),o("div",J," You don't have any transcriptions yet! ")),e("div",K,[!s.isFetchingMore&&s.currentPage<s.lastPage?(i(),o("button",{key:0,class:"btn btn-lg btn-secondary mt-5 mb-5",onClick:t[3]||(t[3]=(...r)=>s.loadMore&&s.loadMore(...r))},"Load More")):n("",!0),s.isFetchingMore?(i(),o("div",O,R)):n("",!0)])])]))])]),_:1})}const rs=L(w,[["render",W]]);export{rs as default};
